# ~/.ssh-audit.conf
# Risk Scoring Configuration for ssh-key-audit.sh v1.5.0+
#
# Usage:
#   - Place in ~/.ssh-audit.conf (user), ./.ssh-audit.conf (repo), or /etc/ssh-audit/config.conf (system)
#   - Override via: ./ssh-key-audit.sh --risk-config /custom/path.conf
#   - Env vars take precedence: SSH_AUDIT_RISK_WEAK_SSH_RSA=75 ./ssh-key-audit.sh --risk
#
# Weights: 0-100 (higher = more severe)

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# TARGET-LEVEL ISSUES
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# ~/.ssh directory permissions (expected: 700)
# Risk: Exposes private keys, authorized_keys, known_hosts to other users
SSH_AUDIT_RISK_SSH_DIR_PERMS=40

# authorized_keys file permissions (expected: 600)
# Risk: Allows unauthorized key injection by local users
SSH_AUDIT_RISK_AUTH_KEYS_PERMS=35

# Missing authorized_keys file
# Risk: Informational only (user may not have SSH access configured)
SSH_AUDIT_RISK_AUTH_KEYS_MISSING=5

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# KEY TYPE ISSUES (Weak Cryptography)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# ssh-rsa (RSA with SHA-1 signatures)
# Risk: SHA-1 collision attacks demonstrated in 2017, deprecated OpenSSH 8.8+
# Recommendation: Migrate to ssh-ed25519 or rsa-sha2-256/512
SSH_AUDIT_RISK_WEAK_SSH_RSA=50

# ssh-dss (DSA)
# Risk: Weak 1024-bit keys, nonce reuse vulnerability, removed OpenSSH 7.0+
# Recommendation: Replace immediately
SSH_AUDIT_RISK_WEAK_SSH_DSS=50

# ecdsa-sha2-nistp256/384/521 (NIST P-curves)
# Risk: Potential NSA backdoors (Dual_EC_DRBG concerns), side-channel attacks
# Recommendation: Prefer ssh-ed25519 (Curve25519)
# Default: 0 (most environments still accept NIST curves; opt-in via config)
SSH_AUDIT_RISK_WEAK_ECDSA_NIST=0

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# KEY HYGIENE ISSUES
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Unsafe options (command=, from=, permitopen=, etc.)
# Risk: Command injection, lateral movement, privilege escalation
# Example: command="/bin/sync" can be exploited via $SSH_ORIGINAL_COMMAND
SSH_AUDIT_RISK_UNSAFE_OPTIONS=35

# Duplicate key (same key_type:blob across multiple targets)
# Risk: Credential reuse increases blast radius if compromised
# Recommendation: Use unique keys per host/service
SSH_AUDIT_RISK_DUPLICATE=20

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# STALE KEY THRESHOLDS
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Note: Thresholds use ">= days" logic (not additive)
# Example: A 547-day key triggers STALE_365 weight (25 pts) only

# Keys >= 365 days old (1+ year)
# Recommendation: Annual rotation policy
SSH_AUDIT_RISK_STALE_365=25

# Keys >= 180 days old (6+ months)
# Recommendation: Bi-annual rotation for sensitive systems
SSH_AUDIT_RISK_STALE_180=15

# Keys >= 90 days old (3+ months)
# Recommendation: Quarterly rotation for high-security environments
SSH_AUDIT_RISK_STALE_90=8

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# RISK LEVEL THRESHOLDS
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

SSH_AUDIT_RISK_THRESHOLD_CRITICAL=85  # Urgent remediation required
SSH_AUDIT_RISK_THRESHOLD_HIGH=50      # Schedule remediation within sprint
SSH_AUDIT_RISK_THRESHOLD_MEDIUM=20    # Monitor and plan for next quarter
SSH_AUDIT_RISK_THRESHOLD_LOW=1        # Informational, no action required

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# SCORING MODIFIERS
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# System target multiplier (applied after capping to RISK_TARGET_MAX)
# Rationale: /etc/ssh/, /root/ keys have higher impact if compromised
SSH_AUDIT_RISK_SYSTEM_MULTIPLIER=1.25

# Maximum score per target (before system multiplier)
SSH_AUDIT_RISK_TARGET_MAX=100

# Maximum score per individual key (prevents accumulation overflow)
SSH_AUDIT_RISK_KEY_MAX=100

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# DISPLAY OPTIONS
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Number of top riskiest targets to show in summary
SSH_AUDIT_RISK_TOP_N=5

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# EXAMPLE CUSTOM POLICIES
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# High-security environment (distrust NIST curves, aggressive rotation)
# SSH_AUDIT_RISK_WEAK_ECDSA_NIST=15
# SSH_AUDIT_RISK_STALE_90=15
# SSH_AUDIT_RISK_STALE_180=25
# SSH_AUDIT_RISK_STALE_365=40

# Compliance-focused (emphasize permissions over key types)
# SSH_AUDIT_RISK_SSH_DIR_PERMS=60
# SSH_AUDIT_RISK_AUTH_KEYS_PERMS=50
# SSH_AUDIT_RISK_WEAK_SSH_RSA=30

# Legacy environment (tolerate ssh-rsa, focus on hygiene)
# SSH_AUDIT_RISK_WEAK_SSH_RSA=20
# SSH_AUDIT_RISK_UNSAFE_OPTIONS=50
# SSH_AUDIT_RISK_DUPLICATE=30
